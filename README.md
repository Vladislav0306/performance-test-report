# **Performance Test Report**

**Ссылка на задание/требования:** https://github.com/netology-code/loadqa-homeworks/blob/main/5.Metrics/homework_lecture5.md

## **Ссылки на предыдущие работы:**

- Введение в тестирование производительности: https://docs.google.com/document/d/1trPD3j2gecMEsNEW6kpvOl3JM9BB-xGdBLJ06h9Nvsw/edit#
- Мониторинг: https://github.com/Vladislav0306/load-testing-stand
- Проведение нагрузочного тестирования WEB: https://github.com/Vladislav0306/load-web-testing
- Проведение тестирования БД: https://github.com/Vladislav0306/db-load-testing

## **Содержание**

1. [Краткое описание](#краткое-описание)
2. [Задачи](#задачи)
3. [Используемые инструменты (ПО)](<#используемые-инструменты-(ПО)>)
4. [Ожидаемое количество посетителей сервиса бронирования билетов](#ожидаемое-количество-посетителей-сервиса-бронирования-билетов)
5. [Тестовая среда](#тестовая-среда)
6. [Результаты профиля нагрузочного тестирования сервиса бронирования билетов](#результаты-профиля-нагрузочного-тестирования-сервиса-бронирования-билетов)
7. [Результаты нагрузочного тестирования сервиса бронирования билетов](#результаты-нагрузочного-тестирования-сервиса-бронирования-билетов)
8. [Результаты мониторинга системы при выполнении нагрузочного тестирования сервиса бронирования билетов](#результаты-мониторинга-системы-при-выполнении-нагрузочного-тестирования-сервиса-бронирования-билетов)
9. [Рекомендации для оптимизации сервиса бронирования билетов](#рекомендации-для-оптимизации-сервиса-бронирования-билетов)

## **Краткое описание**

Данный отчет представляет итоги проведения тестирования производительности сервиса бронирования билетов.

## **Задачи**

В рамках тетстирования производительности было несколько задач:

- Провести прогноз количества посетителей сервиса бронирования билетов при увеличении количества кинотеатров в разных городах;

- Создать профиль нагрузочного тестирования

- Определить параметры тестовой среды исходя из среды, на которой расположен сервис бронирования билетов;

- Провести нагрузочное тестирование сервиса бронирования билетов;

- Оценить состояние базовых параметров оборудования/ОС при проведении нагрузочного тестирования.

## **Используемые инструменты (ПО)**

- Для нагрузочного тетсирования: JMeter и BlazeMeter.

- Для объемного тестирования: JMeter.

- Для мониторинга системы: Telegraph + InfluxDB + Grafana (докер - контейнер) и node-exporter + prometheu + Grafana (докер - контейнер).

## **Ожидаемое количество посетителей сервиса бронирования билетов**

| Параметры                                                   | Результаты                                                                                                                            |
| ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Количество посетителей в сутки во всех кинотеатрах          | Ожидается 2 003 посетителей в сутки во все кинотеатры сети, если предположить, что в будние и в выходные дни посещаемость одинаковая. |
| Количество посетителей в выходные дни                       | Посещаемость в выходные дни обычно увеличивается в 2 раза, таким образом, количество посетителей может возрасти до 4 006 в сутки.     |
| Влияение того, что города находятся в разных часовых поясах | В выходные дни с 10 до 13 по московскому времени совпадают пики посещаемости в Москве и во Владивостоке.                            |
| Ожидаемое количество посетителей на сайте в выходной день   | Гостей - 1 602, Покупатели онлайн - 2 603, Продавец - 1 402, Администратор - 15                                                       |

## **Тестовая среда**

| Параметры               | Значения          |
| ----------------------- | ----------------- |
| Особенности сервера     | Выделенный сервер |
| Количество серверов     | Один              |
| CPU - количество ядер   | 8 ядер            |
| RAM                     | 64 Гб             |
| Disk SSD                | Один Тб           |
| Поправочный коэффициент | 2                 |

**Примечание:** тестирование выполнялось на ПК (процессор - Intel(R) Core(TM) i7-3537U CPU @ 2.00GHz  2.50GHz, оперативная память - 8,00 ГБ (7,88 доступно). OS Windows 7.

## **Результаты профиля нагрузочного тестирования сервиса бронирования билетов**

| Параметры                                                                                        | Значения                                                                                       |
| ------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |
| Роли                                                                                             | Гость (2 сценария), Покупатель (3 сценария), Продавец (1 сценирий), Администратор (1 сценарий) |
| Общее количество сценариев                                                                       | 7                                                                                              |
| Интервал, сек                                                                                    | 3600                                                                                           |
| Суммарное количество потоков(пользователей) за измеряемый интервал времени, выполняющих сценарий | 469                                                                                            |
| Общее количество запросов за интервал                                                            | 2 952                                                                                          |
| RPS                                                                                              | 53,73                                                                                          |
| RPS с учетом поправочного коэффициента                                                           | 26,8                                                                                           |

## **Результаты нагрузочного тестирования сервиса бронирования билетов**

**Примечание:** упрощение в том, что выполнялся один сценарий (покупка билета в кинотеатре и получение QR кода).

**Результаты при заданной (оптимальной) нагрузке с учетом рассчитанного количества посетителей сервиса**

RPS c учетом поправочного коэффициента: 26,8.

Схема достижения необходимого RPS: количество тредов - 50, количество повторений - 100.

Тест выполнялся в течение 5 минут.

![RPS при обычной нагурзке](/Load/Usual/RPSinUsual.png)

![Распределение времени ответов при обычной нагрузке](/Load/Usual/DistributionInUsual.png)

![Перцентили при обычной нагрузке](/Load/Usual/PercentilesInUsual.png)

![Отчет при обычной нагрузке](/Load/Usual/AggregateReportInUsual.png)

**Выводы:**

- Сервис эффективно работает при достижении заданного RPS.

**Результаты выявления предела нагрузки/стрессс - тестирование (постепенное возрастание нагрузки - выше расчитанного RPS)**

Схема: увеличение количество тредов на 10 каждую 1 сек до достижения 400 тредов.

Критерии предела нагрузки:

- Появление ответов с кодами ошибок/другие ошибки (более 5%)
- Длительное время ответа на запросы: > 10 сек

Тест выполнялся в течение 3 минут.

![Схема нагрузки](/Load/Overload/shedule.png)

![Количество запросов](/Load/Overload/HPS.png)

![Коды](/Load/Overload/codes.png)

![Время отклика](/Load/Overload/Latencies.png)

![Распределение времени ответа](/Load/Overload/timeDistribution.png)

![Перцентили](/Load/Overload/Percentilies.png)

![Отчет](/Load/Overload/AggregateReport.png)

**Выводы:**

- Точка предела нагрузки: 276 тредов, RPS от 60 до 90. Причина автоматической остановки теста - появление ошибок ("Non HTTP response code: java.net.SocketException");

- Наибольшее количество ошибок при открытии страницы.

## **Результаты мониторинга системы при выполнении нагрузочного тестирования сервиса бронирования билетов**

**При обычном нагрузочном тестировании**

Прараметры нагрузочного тестирования (пиковые, по данным JMeter): количество тредов - 50, RPS - от 20 до 30.

![CPU при обычной нагрузке](/Monitoring/CPUduringUsual.png)

**Выводы:** Нагруженность системы увеличилась на 1,5 - 2%. Система хорошо функционирует при обычной нагрузке.

**При поиске предела производительности (стресс - тестирование)**

Прараметры нагрузочного тестирования (пиковые, по данным JMeter): количество тредов 276, RPS - от 60 до 90.

![CPU при высокой нагрузке](/Monitoring/CPUduringOverload.png)

**Выводы:** Нагруженность системы увеличилась на 12%. Стенд тестирования справился с высокой нагрузкой.

## **Рекомендации для оптимизации сервиса бронирования билетов**

- Сервис хорошо функционирует при заданных условиях нагрузки. Ресурсов системы достаточно для обеспечения бесперебойной работы.

- Явная оптимизация сервиса не требуется.